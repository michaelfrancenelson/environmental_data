---
title: "ECo 602 - Analysis of Environmental Data"
subtitle: "Standard Error and the Sampling Distribution"
author: "Michael France Nelson"
date: "Fall 2020"
output:
    beamer_presentation:
    pandoc_args: !expr paste0(here::here("formatting", "beamer", "eco_602_2020_beamer.yaml"))
    highlight: tango
    # theme: "default"
    colortheme: "spruce"
    fonttheme: "serif"
    slide_level: 2
    incremental: false
classoption: t
header-includes:
  \input{`r here::here("formatting", "beamer", "eco_602_2020_headers_tikz.tex")`}
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(rmd.utils)

image_output_dir =
  file.path(find_file(
    "standard_error_and_sampling_distribution",
    directory = TRUE),
    "figures")

pois_sample_fmt = "Sample of %d individuals\nmean = %0.4s, var = %0.4s"
pois_pop_fmt = "A Poisson-distributed population\nmean = %0.4s, var = %0.4s"


lmbda = 4.5
n_pop = 10000

pop_poisson = rpois(n_pop, lmbda)



sample_pois_mean = function(n_sims, n_samps)
{
  out = c()
  for (i in 1:n_sims)
    out = c(out, mean(sample(pop_poisson, n_samps, replace = TRUE)))
  return(out)
}

hh = function(x, x_lim =  c(mean(pop_poisson) - 2, mean(pop_poisson) + 2), n_sims = 1500)
{
  hist(
    sample_pois_mean(n_sims, x),
    main = sprintf(sampling_dist_of_mean_fmt, x),
    xlim = x_lim, xlab = xlab, ylab = ylab, 
    axes = FALSE)
  axis(1)
}


h_samp = function(n)
{
  samp1 = sample(pop_poisson, n, replace = TRUE)
  hist(samp1,
       main = sprintf(
         pois_sample_fmt,
         n, mean(samp1), var(samp1)), xlab = "count")
}

sampling_dist_of_mean_fmt = "Sampling distribution of the mean\nsample size: %s"
sampling_dist_of_mean_fmt = "n = %s"

x_lim = c(mean(pop_poisson) - 2, mean(pop_poisson) + 2)

xlab = ""
ylab = ""


oma_hist = c(0, 0, 0, 0)
mar_hist_1 =  c(1, 1, 1, 0)

# histogram of whole population
par(oma = oma_hist)
png(file.path(
  image_output_dir, "simulated_poisson_population.png"), 
  width = 1600, height = 800, res = 120)
hist(pop_poisson,
     main = sprintf(
       pois_pop_fmt,
       mean(pop_poisson), var(pop_poisson)), 
     xlab = "count")
dev.off()



# ---- histogram of sample size 500 ----
set.seed(12345)
png(file.path(
  image_output_dir, "sample_500.png"), 
  width = 1600, height = 800, res = 120)
par(oma = c(0, 0, 0, 0))
h_samp(500)
dev.off()


# ---- histogram of sample size 80 ----
{
  nn = 80
  png(file.path(
    image_output_dir, "samples_80.png"), 
    width = 1600, height = 800, res = 120)
  par(mfrow = c(2, 2), mar = c(3, 1, 2, 0), oma = c(0, 0, 0, 0))
  h_samp(nn)
  h_samp(nn)
  h_samp(nn)
  h_samp(nn)
  dev.off()
}



{
  png(file.path(
    image_output_dir, "sampling_distribution_mean_poisson.png"), 
    width = 1600, height = 800, res = 120)
  par(mfrow = c(2, 2), mar = c(1, 0, 2, 0), oma = c(0, 0, 0, 0))
  hh(30)
  hh(50)
  hh(100)
  hh(200)
  dev.off()
}




out = c()
for (i in 1:n_sims)
  out = c(out, mean(sample(pop_poisson, n_samps, replace = TRUE)))

hist(out, main = sprintf(sampling_dist_of_mean_fmt, n_samps))


```



## Intuition: simulation experiments

This is technical material.  Let's try to build some intuition with graphical examples.

### A non-normal distribution: a Poisson-distributed popualtion

- Create a  population of 10,000 individuals.
- Do repeated sampling and calculate the mean.
- Examine the *sampling distribution* of the mean.



## Poisson population

- 10000 individuals, lambda = 4.5

![](`r find_file("simulated_poisson_population.png")`)







## Sample from the population

Intuitively, we might think a sample would have a similar distribution to the population.

Let's take a sample of 500:

```{r echo = FALSE, fig.width=4, fig.asp=0.75, fig.align='center'}
samp1 = sample(pop_poisson, 500, replace = TRUE)
par(oma = c(0, 0, 0, 0))
hist(samp1,
     main = sprintf(
       pois_sample_fmt,
       500, mean(samp1), sd(samp1)), xlab = "count")
```



## Sample from the population: 100 samples


```{r sample_100, echo = FALSE, fig.width=4, fig.asp=0.75, fig.align='center'}
samp1 = sample(pop_poisson, 100, replace = TRUE)
par(oma = c(0, 0, 0, 0))
hist(samp1,
     main = sprintf(
       pois_sample_fmt,
       100, mean(samp1), sd(samp1)), xlab = "count")
```


## Sample from the population: 100 samples

```{r ref.label='sample_100', echo = FALSE, fig.width=4, fig.asp=0.75, fig.align='center'}
```
## Sample from the population: 100 samples

```{r ref.label='sample_100', echo = FALSE, fig.width=4, fig.asp=0.75, fig.align='center'}
```
## Sample from the population: 100 samples

```{r ref.label='sample_100', echo = FALSE, fig.width=4, fig.asp=0.75, fig.align='center'}
```





## Sampling Distribution of the mean

### What should the distribution of the *means* in repeated sampling look like?

With sample size of 30:


```{r echo = FALSE, fig.width=4, fig.asp=0.75, fig.align='center'}
n_sims = 5000
n_samps = 30
sampling_dist_of_mean_fmt = "Sampling distribution of the mean\nsample size: %s"

out = c()
for (i in 1:n_sims)
  out = c(out, mean(sample(pop_poisson, n_samps, replace = TRUE)))

hist(out, main = sprintf(sampling_dist_of_mean_fmt, n_samps))

```






## Sampling distribution of the mean

- The spread of the sampling distribution affects the confidence interval width.

![](`r find_file("sampling_distribution_mean_poisson.png")`)





## Key Points

\begin{blueborder}{0.9\textwidth}{This seems complicated, why do we care?} \begin{itemize} \item We use the sampling distribution to quantify \textit{confidence} and \textit{significance} in Frequentist \textit{inference}.
\end{itemize}
\end{blueborder}

- The standard error gets smaller with increasing sample size.
- The sample standard deviation (and other sample statistics) stabilizes with increasing sample size.
- Confidence intervals are calculated from standard errors: CIs get narrower with larger samples!

